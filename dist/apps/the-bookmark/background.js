const storageKey={TRACK_URL_LIST:"track_url_list"},messageTopic={TRACK_CURRENT:TRACK_CURRENT="track_current"};chrome.tabs.onCreated.addListener((e=>{console.log("tabs:",e)})),chrome.tabs.onUpdated.addListener((async(e,o,t)=>{console.log("onAttached ---\x3e tabID:: "+e+" changeInfo:: "+JSON.stringify(o)+" tab :: "+JSON.stringify(t));const r=t?.url?.split("/"),s=r[r.length-1].split(".")[0];(await getFromStorage(storageKey.TRACK_URL_LIST)).findIndex((e=>e?.url?.includes(s)))<0?console.log("tracking not requested for this url"):(console.log("localstorage ---\x3e"+chrome.storage),"complete"===o.status&&chrome.bookmarks.getTree((e=>{console.log(e),rec(e,t)})))}));const rec=(e,o)=>{if(e.length)for(let t=0;t<e.length;t++)rec(e[t],o);else if(e.hasOwnProperty("children")&&e.children.length)rec(e?.children,o);else{const t=o?.url?.split("/"),r=t[t.length-1].split(".")[0];if(r&&e?.url?.includes(r))return console.log(e),updateBookMark(e,o),e}},updateBookMark=(e,o)=>{e.id&&chrome.bookmarks.update(e.id,{url:o.url,title:o.title},(e=>{console.log("updated Bookmark",e)}))};function messageReceived(e){if(e?.topic===messageTopic.TRACK_CURRENT){let o=e?.data?.[0];const t=o?.url?.split("/"),r=t[t.length-1].split(".")[0];return getFromStorage(storageKey.TRACK_URL_LIST).then((e=>{let t=e.findIndex((e=>e?.url?.includes(r)));t>=0?(console.log("already in store for this url"),e[t]={url:o.url,title:o.title},setInStorage(storageKey.TRACK_URL_LIST,e)):(console.log("new url value to store"),setInStorage(storageKey.TRACK_URL_LIST,[...e,{url:o.url,title:o.title}]))})),console.log("background js message recieved ---\x3e ",e),"message recieved by background js"}}async function setInStorage(e,o){return new Promise(((t,r)=>{try{chrome.storage.local.set({[e]:o},(function(){console.log("Value is set to ",o),t("Value is set to "+o)}))}catch(s){console.log("error in setInstorgae")}}))}function getFromStorage(e){return new Promise(((o,t)=>{try{chrome.storage.local.get(e,(function(t){console.log("Value currently is ",t[e]),o(t[e])}))}catch(r){console.log("error in getFromStorage")}}))}chrome.runtime.onMessage.addListener(messageReceived);